(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{437:function(t,e,n){"use strict";e.a={data:function(){return{disabled:!1,text:"获取验证码"}},methods:{sendCode:function(){var t=this;if(!this.disabled){this.disabled=!0;var e=60;this.text="剩余 "+e+"s";var n=setInterval((function(){(e-=1)<0&&clearInterval(n),t.text="剩余 "+e+"s",t.text<"剩余 0s"&&(t.disabled=!1,t.text="重新获取")}),1e3)}}}}},449:function(t,e,n){var content=n(521);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(3).default)("0e2b8483",content,!0,{sourceMap:!1})},520:function(t,e,n){"use strict";var o=n(449);n.n(o).a},521:function(t,e,n){(e=n(2)(!1)).push([t.i,".user-index .user-content[data-v-388566b7]{padding:34px 0}.user-index .user-content .item[data-v-388566b7]{padding-left:16px;position:relative;font-size:14px;border-bottom:1px dashed #ddd;margin-right:54px}.user-index .user-content .item .edit-txt[data-v-388566b7]{position:absolute;right:0;bottom:16px;color:#e93323;cursor:pointer}.user-index .user-content .item .label[data-v-388566b7]{display:inline-block;width:80px;color:#777}.user-index .user-content .item.user-info[data-v-388566b7]{padding-bottom:20px}.user-index .user-content .item.user-info .title[data-v-388566b7]{color:#282828;font-size:18px}.user-index .user-content .item.user-info .info[data-v-388566b7]{margin-top:20px;color:#777;font-size:14px}.user-index .user-content .item.user-info .info img[data-v-388566b7]{width:80px;height:80px;border-radius:50%;vertical-align:-44px;display:inline-block}.user-index .user-content .item.text-info[data-v-388566b7]{height:70px;line-height:70px}.user-index .user-content .item.text-info .edit-txt[data-v-388566b7]{top:0}.user-index .user-content .item.text-info .txt[data-v-388566b7]{color:#282828;width:700px}.user-index .user-content .out-btn[data-v-388566b7]{text-align:right;margin-right:54px}.user-index .user-content .out-btn span[data-v-388566b7]{display:inline-block;width:130px;height:40px;margin-top:38px;line-height:40px;text-align:center;background:#e93323;color:#fff;border-radius:4px;cursor:pointer}.input-item[data-v-388566b7]{display:flex;align-items:center;margin-bottom:20px}.input-item .code-box[data-v-388566b7]{width:115px;height:40px;text-align:center;cursor:pointer;margin-left:30px}.dialog-footer[data-v-388566b7]{display:flex;align-items:center;justify-content:center;padding-top:40px;border-top:1px solid #efefef}.dialog-footer button[data-v-388566b7]{width:190px;height:45px}.user-header[data-v-388566b7]:hover{transform:rotate(666turn);transition:all 59s cubic-bezier(.34,0,.84,1) 1s}",""]),t.exports=e},580:function(t,e,n){"use strict";n.r(e);n(221),n(6);var o=n(107),r=n.n(o),c=(n(26),n(38),n(4)),d=(n(223),n(147)),l=n.n(d),h=n(437),v=n(62),f={name:"index",auth:"guest",mixins:[h.a],data:function(){return{userInfo:{},fileList:[],upLoadUrl:v.a.apiBaseURL+"/upload/image",myHeaders:{},isPassword:!1,passwordData:{phone:"",code:"",newPassword:""},isPhone:!1,phoneData:{code:"",newPhone:""},keyCode:""}},fetch:function(t){var e=t.store;e.commit("isHeader",!0),e.commit("isFooter",!0)},head:function(){return{title:"账户管理-"+this.$store.state.titleCon}},created:function(){},mounted:function(){var t=this.$cookies.get("auth.strategy");this.myHeaders={Authorization:this.$cookies.get("auth._token.".concat(t))},this.userInfo=this.$auth.user,this.getCodeKey()},methods:{getCodeKey:function(){var t=this;this.$axios.$get("/verify_code").then((function(e){t.keyCode=e.key}))},handleSuccess:function(data){var t=this;if(400==data.status)return this.$message.error(data.msg);this.$axios.post("user/edit",{avatar:data.data.url,nickname:this.userInfo.nickname}).then((function(e){var n=JSON.parse(JSON.stringify(t.userInfo));n.avatar=data.data.url,t.$auth.$storage.setUniversal("user",n),t.userInfo=t.$auth.user,t.$message.success("修改成功")})).catch((function(t){}))},handleExceed:function(t,e){this.$message.warning("请勿频繁重复上传")},handleError:function(t,e){this.$message.error("上传失败")},editName:function(){var t=this;l.a.prompt("请输入昵称","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"昵称不能为空"}).then((function(e){var n=e.value;t.$axios.post("user/edit",{nickname:n,avatar:t.userInfo.avatar}).then((function(e){var o=JSON.parse(JSON.stringify(t.userInfo));o.nickname=n,t.$auth.$storage.setUniversal("user",o),t.userInfo=t.$auth.user,t.$message.success("修改成功")}))})).catch((function(){}))},longOut:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.$cookies.get("auth.strategy"),e.next=3,t.$auth.logout(n).then((function(e){t.$store.commit("cartNum",0),t.$router.replace({path:"/"})}));case 3:case"end":return e.stop()}}),e)})))()},bindPassword:function(){var t=this;return this.passwordData.code?this.passwordData.newPassword?void this.$axios.post("register/reset",{account:this.userInfo.phone,captcha:this.passwordData.code,password:this.passwordData.newPassword}).then((function(e){r.a.success(e.msg),t.isPassword=!1,t.passwordData.phone="",t.passwordData.code="",t.passwordData.newPassword=""})).catch((function(t){return r.a.error(t)})):r.a.error("请填写新密码"):r.a.error("请填写验证码")},handleClose:function(){this.isPassword=!1,this.isPhone=!1,this.passwordData.phone="",this.passwordData.code="",this.passwordData.newPassword="",this.phoneData.code="",this.phoneData.newPhone=""},getCode:function(t){var e=this;return Object(c.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=e,0!=t){n.next=6;break}return n.next=4,e.$axios.post("/register/verify",{phone:o.userInfo.phone,type:"mobile",key:o.keyCode}).then((function(t){r.a.success(t.msg),o.sendCode()})).catch((function(t){r.a.error(t)}));case 4:n.next=8;break;case 6:return n.next=8,e.$axios.post("/register/verify",{phone:o.phoneData.newPhone,type:"mobile",key:o.keyCode}).then((function(t){r.a.success(t.msg),o.sendCode()})).catch((function(t){r.a.error(t)}));case 8:case"end":return n.stop()}}),n)})))()},bindNewPhone:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=t).phoneData.newPhone){e.next=3;break}return e.abrupt("return",r.a.error("请填写新手机号码"));case 3:if(/^1(3|4|5|7|8|9|6)\d{9}$/i.test(n.phoneData.newPhone)){e.next=5;break}return e.abrupt("return",r.a.error("请输入正确的手机号码"));case 5:if(n.phoneData.code){e.next=7;break}return e.abrupt("return",r.a.error("请填写验证码"));case 7:t.$axios.post("user/updatePhone",{phone:n.phoneData.newPhone,captcha:n.phoneData.code,key:n.keyCode}).then((function(e){r.a.success(e.msg),t.isPhone=!1,t.phoneData.newPhone="",t.phoneData.code=""})).catch((function(t){return r.a.error(t)}));case 8:case"end":return e.stop()}}),e)})))()}}},x=(n(520),n(13)),component=Object(x.a)(f,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"user-index"},[n("div",{staticClass:"user-com-title",staticStyle:{"padding-left":"16px"}},[t._v("账户管理")]),t._v(" "),n("div",{staticClass:"user-content"},[n("div",{staticClass:"item user-info"},[n("div",{staticClass:"info"},[n("span",{staticClass:"label"},[t._v("我的头像：")]),t._v(" "),n("img",{staticClass:"user-header",attrs:{src:t.userInfo.avatar,alt:""}})]),t._v(" "),n("div",{staticClass:"edit-txt"},[n("el-upload",{staticClass:"upload-demo",attrs:{action:t.upLoadUrl,"on-success":t.handleSuccess,"show-file-list":!1,multiple:!1,limit:3,"on-exceed":t.handleExceed,"on-error":t.handleError,headers:t.myHeaders,"file-list":t.fileList}},[t._v("\n          修改\n        ")])],1)]),t._v(" "),n("div",{staticClass:"item text-info"},[n("span",{staticClass:"label"},[t._v("我的昵称：")]),t._v(" "),n("span",{staticClass:"txt line1",staticStyle:{display:"inline-block","vertical-align":"middle"}},[t._v(t._s(t.userInfo.nickname))]),t._v(" "),n("div",{staticClass:"edit-txt",on:{click:t.editName}},[t._v("修改")])]),t._v(" "),n("div",{staticClass:"item text-info"},[n("span",{staticClass:"label"},[t._v("手机号：")]),t._v(" "),n("span",{staticClass:"txt"},[t._v(t._s(t.userInfo.phone))]),t._v(" "),n("div",{staticClass:"edit-txt",on:{click:function(e){t.isPhone=!0}}},[t._v("修改")])]),t._v(" "),n("div",{staticClass:"item text-info"},[n("span",{staticClass:"label"},[t._v("我的ID：")]),t._v(" "),n("span",{staticClass:"txt"},[t._v(t._s(t.userInfo.uid))])]),t._v(" "),n("div",{staticClass:"item text-info"},[n("span",{staticClass:"label"},[t._v("密码设置：")]),t._v(" "),n("span",{staticClass:"txt"},[t._v("******")]),t._v(" "),n("div",{staticClass:"edit-txt",on:{click:function(e){t.isPassword=!0}}},[t._v("修改密码")])]),t._v(" "),n("div",{staticClass:"out-btn"},[n("span",{on:{click:t.longOut}},[t._v("退出登录")])])]),t._v(" "),n("el-dialog",{attrs:{title:"修改密码",visible:t.isPassword,width:"545px","before-close":t.handleClose},on:{"update:visible":function(e){t.isPassword=e}}},[n("div",{staticClass:"form-box"},[n("div",{staticClass:"input-item"},[n("el-input",{attrs:{placeholder:"请输入手机号码",disabled:""},model:{value:t.userInfo.phone,callback:function(e){t.$set(t.userInfo,"phone",e)},expression:"userInfo.phone"}},[n("template",{slot:"prepend"},[t._v("+86")])],2)],1),t._v(" "),n("div",{staticClass:"input-item"},[n("el-input",{attrs:{placeholder:"请输入验证码"},model:{value:t.passwordData.code,callback:function(e){t.$set(t.passwordData,"code",e)},expression:"passwordData.code"}}),t._v(" "),n("el-button",{staticClass:"code-box",attrs:{plain:"",disabled:t.disabled},on:{click:function(e){return t.getCode(0)}}},[t._v(t._s(t.text))])],1),t._v(" "),n("div",{staticClass:"input-item"},[n("el-input",{attrs:{placeholder:"请输入新密码",type:"password"},model:{value:t.passwordData.newPassword,callback:function(e){t.$set(t.passwordData,"newPassword",e)},expression:"passwordData.newPassword"}})],1)]),t._v(" "),n("div",{staticClass:"dialog-footer"},[n("span",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:t.bindPassword}},[t._v("确 定")]),t._v(" "),n("el-button",{on:{click:t.handleClose}},[t._v("取 消")])],1)])]),t._v(" "),n("el-dialog",{attrs:{title:"修改手机号码",visible:t.isPhone,width:"545px","before-close":t.handleClose},on:{"update:visible":function(e){t.isPhone=e}}},[n("div",{staticClass:"form-box"},[n("div",{staticClass:"input-item"},[n("el-input",{attrs:{placeholder:"请输入新手机号码"},model:{value:t.phoneData.newPhone,callback:function(e){t.$set(t.phoneData,"newPhone",e)},expression:"phoneData.newPhone"}},[n("template",{slot:"prepend"},[t._v("+86")])],2)],1),t._v(" "),n("div",{staticClass:"input-item"},[n("el-input",{attrs:{placeholder:"请输入验证码"},model:{value:t.phoneData.code,callback:function(e){t.$set(t.phoneData,"code",e)},expression:"phoneData.code"}}),t._v(" "),n("el-button",{staticClass:"code-box",attrs:{plain:"",disabled:t.disabled},on:{click:function(e){return t.getCode(1)}}},[t._v(t._s(t.text))])],1)]),t._v(" "),n("div",{staticClass:"dialog-footer"},[n("span",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:t.bindNewPhone}},[t._v("确 定")]),t._v(" "),n("el-button",{on:{click:t.handleClose}},[t._v("取 消")])],1)])])],1)}),[],!1,null,"388566b7",null);e.default=component.exports}}]);